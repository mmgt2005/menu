<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Menu Display - Cycling Categories</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
        }
        .fade-in {
            animation: fadeIn 0.7s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        /* CUSTOM FONT SIZE FOR HIGH DENSITY */
        .text-xxs {
            font-size: 0.65rem; /* Equivalent to about 10.4px or smaller than 'text-xs' (0.75rem) */
            line-height: 0.85rem;
        }
        /* Tailwind custom dimensions to support tripling */
        .w-64 { width: 16rem; } 
        .h-64 { height: 16rem; }
        .w-44 { width: 11rem; } 
        .h-44 { height: 11rem; }
        .w-32 { width: 8rem; }
        .h-32 { height: 8rem; }
        .w-24 { width: 6rem; } 
        .h-24 { height: 6rem; }

        /* Line clamp classes remain unchanged */
        .line-clamp-1 { display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden; }
        .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .line-clamp-3 { display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
        .line-clamp-4 { display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical; overflow: hidden; }
        .line-clamp-5 { display: -webkit-box; -webkit-line-clamp: 5; -webkit-box-orient: vertical; overflow: hidden; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const menuData = {
            restaurant: {
                name: "Bella Vista",
                logo: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=200&h=200&fit=crop",
                tagline: "Fine Dining Experience"
            },
            categories: [
                {
                    id: 1,
                    name: "Appetizers",
                    items: Array.from({length: 10}, (_, i) => ({
                        id: 100 + i,
                        name: `Appetizer ${i + 1}`,
                        description: "Delicious starter dish, perfect for sharing before the main course. A wonderful way to begin your dining experience. A longer sentence for maximum wrapping.",
                        price: 8.99 + i,
                        image: "https://images.unsplash.com/photo-1572695157366-5e585ab2b69f?w=400&h=300&fit=crop",
                        soldOut: i === 3
                    }))
                },
                {
                    id: 2,
                    name: "Entrees",
                    items: Array.from({length: 24}, (_, i) => ({ 
                        id: 200 + i,
                        name: `Entree ${i + 1}`,
                        description: "Our main course specialty, featuring the freshest seasonal ingredients. A culinary delight you won't forget. This is a longer description for maximum density testing.",
                        price: 15.99 + i * 0.5,
                        image: "https://images.unsplash.com/photo-1574071318508-1cdbab80d002?w=400&h=300&fit=crop",
                        soldOut: i === 5 || i === 12
                    }))
                },
                {
                    id: 3,
                    name: "Sides",
                    items: Array.from({length: 8}, (_, i) => ({
                        id: 300 + i,
                        name: `Side ${i + 1}`,
                        description: "Perfect accompaniment to enhance your meal. Ask your server for today's selection.",
                        price: 4.99 + i * 0.5,
                        image: "https://images.unsplash.com/photo-1608897013039-887f21d8c804?w=400&h=300&fit=crop",
                        soldOut: i === 7
                    }))
                },
                {
                    id: 4,
                    name: "Drinks",
                    items: Array.from({length: 15}, (_, i) => ({
                        id: 400 + i,
                        name: `Drink ${i + 1}`,
                        description: "A refreshing beverage to complement your dish. Choose from our curated list of drinks.",
                        price: 3.99 + i * 0.25,
                        image: "https://images.unsplash.com/photo-1437418747212-8d9709afab22?w=400&h=300&fit=crop",
                        soldOut: i === 10
                    }))
                },
                {
                    id: 5,
                    name: "Desserts",
                    items: Array.from({length: 5}, (_, i) => ({
                        id: 500 + i,
                        name: `Dessert ${i + 1}`,
                        description: "A sweet ending to your meal. All desserts are freshly made in-house.",
                        price: 7.99 + i,
                        image: "https://images.unsplash.com/photo-1571877227200-a0d98ea607e9?w=400&h=300&fit=crop",
                        soldOut: false
                    }))
                }
            ]
        };

        // --- Helper Components ---

        function MenuItem({ item, styles, clampClass, showImages }) {
            const hasImage = showImages && item.image;
            const itemClasses = item.soldOut ? 'opacity-60' : '';

            return (
                <div key={item.id} className={`flex ${styles.gap} ${itemClasses} items-start p-0.5`}>
                    {hasImage && (
                        <div className="flex-shrink-0">
                            <div className={`relative ${styles.imageSize} mb-0.5`}>
                                <img 
                                    src={item.image} 
                                    alt={item.name}
                                    className="w-full h-full object-cover rounded"
                                />
                                {item.soldOut && (
                                    <div className="absolute inset-0 bg-black bg-opacity-70 flex items-center justify-center rounded">
                                        <span className="bg-red-600 text-white px-1 py-0.5 rounded text-xs font-bold">OUT</span>
                                    </div>
                                )}
                            </div>
                            <div className="text-center">
                                <span className={`${styles.priceSize} font-bold text-gray-900`}>${item.price.toFixed(2)}</span>
                            </div>
                        </div>
                    )}
                    <div className="flex-1 min-w-0 flex flex-col"> 
                        <h3 className={`${styles.nameSize} font-bold text-slate-800 leading-tight`}>{item.name}</h3>
                        <p className={`${styles.descSize} text-slate-600 leading-snug ${clampClass}`}>{item.description}</p>
                        {!hasImage && (
                            <div className="flex items-center mt-auto pt-0.5">
                                <span className={`${styles.priceSize} font-bold text-gray-900`}>${item.price.toFixed(2)}</span>
                                {item.soldOut && (
                                    <span className="inline-block bg-red-600 text-white px-1 py-0.5 rounded text-xs font-bold ml-2">OUT</span>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // --- Scaling Tiers Logic (Updated Image Sizes) ---

        function CategoryScreen({ category, showImages, clampClass }) {
            const itemCount = category.items.length;

            const getItemSizeClass = (count) => {
                if (count <= 8) return 'xlarge';
                if (count <= 15) return 'large';
                if (count <= 25) return 'medium';
                return 'small';
            };

            const getSizeStyles = (sizeClass) => {
                switch(sizeClass) {
                    case 'xlarge': 
                        // Tripled image size: w-64 h-64 (from original w-20 h-20)
                        return { imageSize: 'w-64 h-64', nameSize: 'text-lg', descSize: 'text-sm', priceSize: 'text-sm', gap: 'gap-3', cols: 2, rows: Math.ceil(itemCount / 2) };
                    case 'large': 
                        // Tripled image size: w-44 h-44 (from original w-14 h-14)
                        return { imageSize: 'w-44 h-44', nameSize: 'text-sm', descSize: 'text-xxs', priceSize: 'text-xs', gap: 'gap-2', cols: 3, rows: Math.ceil(itemCount / 3) };
                    case 'medium': 
                        // Tripled image size: w-32 h-32 (from original w-10 h-10)
                        return { imageSize: 'w-32 h-32', nameSize: 'text-xs', descSize: 'text-xxs', priceSize: 'text-xs', gap: 'gap-1', cols: 4, rows: Math.ceil(itemCount / 4) };
                    default: 
                        // Tripled image size: w-24 h-24 (from original w-8 h-8)
                        return { imageSize: 'w-24 h-24', nameSize: 'text-xs', descSize: 'text-xxs', priceSize: 'text-xs', gap: 'gap-0.5', cols: 5, rows: Math.ceil(itemCount / 5) };
                }
            };
            
            const sizeClass = getItemSizeClass(itemCount);
            const styles = getSizeStyles(sizeClass);

            styles.cols = Math.max(styles.cols, Math.ceil(Math.sqrt(itemCount)));
            styles.rows = Math.ceil(itemCount / styles.cols);


            const gridTemplateColumns = `repeat(${styles.cols}, 1fr)`;
            const gridAutoRows = 'minmax(0, 1fr)'; 

            return (
                <div className="h-full bg-white rounded-lg border-2 border-gray-300 overflow-hidden flex flex-col fade-in">
                    <div className="bg-gray-900 px-6 py-3 border-b-2 border-gray-900 flex-shrink-0">
                        <h2 className="text-3xl font-bold text-white">{category.name}</h2>
                    </div>
                    <div className="flex-1 overflow-hidden p-3"> 
                        <div className="grid h-full" style={{
                            gridTemplateColumns: gridTemplateColumns,
                            gridAutoRows: gridAutoRows, 
                            gap: styles.gap 
                        }}>
                            {category.items.map((item) => (
                                <MenuItem 
                                    key={item.id} 
                                    item={item} 
                                    styles={styles} 
                                    clampClass={clampClass} 
                                    showImages={showImages} 
                                />
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        // --- Main Component ---

        function RestaurantMenu() {
            const [menu, setMenu] = useState(menuData);
            const [currentTime, setCurrentTime] = useState(new Date());
            
            const [currentCategoryIndex, setCurrentCategoryIndex] = useState(0); 
            
            const urlParams = new URLSearchParams(window.location.search);
            const showImages = urlParams.get('images') !== 'false';
            const jsonFile = urlParams.get('json');
            const inlineData = urlParams.get('data');
            const refreshInterval = parseInt(urlParams.get('refresh')) || 0;
            const cycleTime = parseInt(urlParams.get('cycle')) || 15; 
            const descLines = parseInt(urlParams.get('descLines')) || 2;
            const taglineParam = urlParams.get('tagline');

            const getDescClassName = () => {
                if (descLines === 1) return 'line-clamp-1';
                if (descLines === 3) return 'line-clamp-3';
                if (descLines === 4) return 'line-clamp-4';
                // Defaulting to 2 lines for descriptions if not specified.
                return 'line-clamp-2'; 
            };
            
            const displayCategories = useMemo(() => 
                menu.categories.filter(cat => cat.items && cat.items.length > 0)
            , [menu.categories]);

            const totalCategories = displayCategories.length;

            useEffect(() => {
                const timer = setInterval(() => {
                    setCurrentTime(new Date());
                }, 60000);
                return () => clearInterval(timer);
            }, []);

            useEffect(() => {
                if (totalCategories > 1 && cycleTime > 0) {
                    const cycleTimer = setInterval(() => {
                        setCurrentCategoryIndex(prevIndex => 
                            (prevIndex + 1) % totalCategories
                        );
                    }, cycleTime * 1000);
                    return () => clearInterval(cycleTimer);
                }
            }, [cycleTime, totalCategories]);
            
            // Data loading effects (omitted for brevity, but they are in the original code)
            useEffect(() => {
                if (inlineData) {
                    try {
                        const decodedData = atob(inlineData);
                        const parsedData = JSON.parse(decodedData);
                        setMenu(parsedData);
                    } catch (err) {
                        console.log('Error parsing inline data:', err);
                    }
                }
            }, [inlineData]);

            useEffect(() => {
                if (jsonFile && !inlineData) {
                    const fetchMenu = () => {
                        fetch(jsonFile)
                            .then(res => res.json())
                            .then(data => setMenu(data))
                            .catch(err => console.log('Error loading JSON:', err));
                    };
                    
                    fetchMenu();
                    
                    if (refreshInterval > 0) {
                        const fetchTimer = setInterval(fetchMenu, refreshInterval * 1000);
                        return () => clearInterval(fetchTimer);
                    }
                }
            }, [jsonFile, refreshInterval, inlineData]);

            useEffect(() => {
                if (refreshInterval > 0 && !jsonFile && !inlineData) {
                    const reloadTimer = setInterval(() => {
                        window.location.reload();
                    }, refreshInterval * 1000);
                    
                    return () => clearInterval(reloadTimer);
                }
            }, [refreshInterval, jsonFile, inlineData]);

            const currentCategory = displayCategories[currentCategoryIndex];
            const clampClass = getDescClassName();
            const displayTagline = taglineParam || menu.restaurant.tagline || "Fine Dining Experience";

            return (
                <div className="h-screen bg-gray-50 text-slate-800 overflow-hidden flex flex-col">
                    
                    {/* Header */}
                    <div className="bg-gray-900 border-b-4 border-gray-700 flex-shrink-0">
                        <div className="max-w-full mx-auto px-6 py-3 flex items-center justify-between">
                            <div className="flex items-center gap-4">
                                <img 
                                    src={menu.restaurant.logo} 
                                    alt={menu.restaurant.name}
                                    className="w-16 h-16 rounded-full object-cover border-2 border-white"
                                />
                                <div>
                                    <h1 className="text-4xl font-extrabold text-white">{menu.restaurant.name}</h1>
                                    <p className="text-gray-300 text-sm">{displayTagline}</p>
                                </div>
                            </div>
                            <div className="text-right">
                                <div className="text-2xl font-bold text-white">
                                    {currentTime.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}
                                </div>
                                <div className="text-sm text-gray-300">
                                    {currentTime.toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' })}
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Main Content Area: Single Category Screen */}
                    <div className="flex-1 overflow-hidden p-4">
                        {currentCategory ? (
                            <CategoryScreen 
                                category={currentCategory} 
                                showImages={showImages} 
                                clampClass={clampClass} 
                                key={currentCategory.id} 
                            />
                        ) : (
                            <div className="h-full flex items-center justify-center bg-white rounded-lg border-2 border-gray-300 fade-in">
                                <div className="text-center">
                                    <h2 className="text-2xl font-bold text-gray-800 mb-2">Menu Coming Soon</h2>
                                    <p className="text-gray-600">Please check back later for our menu items.</p>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Footer */}
                    <div className="bg-gray-900 border-t-4 border-gray-700 flex-shrink-0">
                        <div className="max-w-full mx-auto px-6 py-2 text-center text-gray-300 text-sm">
                            **Now viewing: {currentCategory?.name || 'Loading'}** | Prices and availability subject to change. Please ask your server for today's specials.
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<RestaurantMenu />, document.getElementById('root'));
    </script>
</body>
</html>
